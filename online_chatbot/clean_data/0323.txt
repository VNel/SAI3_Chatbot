1 Cyber-resilient Automatic Generation Control for Systems of AC Microgrids Tong Huang, Member, IEEE, Dan Wu, Member, IEEE, and Marija Ili´c, Life Fellow, IEEE Abstract—In this paper we propose a co-design of the sec- ondary frequency regulation in systems of AC microgrids and its cyber security solutions. We term the secondary frequency regulator a Micro-Automatic Generation Control (µAGC) for highlighting its same functionality as the AGC in bulk power systems. We identify sensory challenges and cyber threats facing the µAGC. To address the sensory challenges, we introduce a new microgrid model by exploiting the rank-one deﬁciency property of microgrid dynamics. This model is used to pose an optimal µAGC control problem that is easily implemented, because it does not require fast frequency measurements. An end- to-end cyber security solution to the False Data Injection (FDI) attack detection and mitigation is developed for the proposed µAGC. The front-end barrier of applying off-the-shelf algorithms for cyber attack detection is removed by introducing a data- driven modeling approach. Finally, we propose an observer-based corrective control for an islanded microgrid and a collaborative mitigation scheme in systems of AC microgrids. We demonstrate a collaborative role of systems of microgrids during cyber attacks. The performance of the proposed cyber-resilient µAGC is tested in a system of two networked microgrids. Index Terms—Cyber security, Automatic Generation Control for Microgrids (µAGC), networked microgrids, inverter-based resource (IBR), False Data Injection (FDI) I. INTRODUCTION The recent decade has witnessed several large-scale elec- tricity outages due to low-probability but high-impact events, such as extreme weather. Examples include the 2012 Hurricane Sandy power outage, the 2020 California rotating electricity outage caused by extreme heat wave [1], and the 2021 Texas power crisis resulting from unusually severe winter storms [2]. During these extreme weather-related events, the bulk transmission systems failed to supply sufﬁcient electric energy to distribution systems, causing millions of businesses and homes to lose their electricity supply [1], [2]. One promising solution to enhance resilience of distribution systems to these extreme events is to integrate Distributed Energy Resources (DERs), e.g., solar panels, micro-turbines, and energy storage, to the distribution systems. However, a large-scale deployment of DERs in the distribution systems introduces unprecedented complexity and the need for extensive Distribution Manage- ment Systems (DMSs) [3], [4]. To reduce the management complexity, a distribution system with massive DERs can This work was supported in part by the U.S. Department of Energy’s Ofﬁce of Energy Efﬁciency and Renewable Energy (EERE) through the Solar Energy Technologies Ofﬁce (SETO) under Grant DE-EE0009031. Tong Huang is with the Department of Electrical and Computer Engi- neering, San Diego State University, San Diego, CA, 92182, USA; e-mail: thuang7@sdsu.edu. Dan Wu and Marija Ili´c are with the Laborarory for Information and Decision Systems at Massachusetts Institute of Technology, Cambridge, MA 02139, USA; e-mail: {danwumit, ilic}@mit.edu. be conﬁgured to be a system of microgrids. Neighboring loads, DERs and their grid infrastructure are clustered into an AC or DC, small-scale power system, i.e., a microgrid. One microgrid can either operate autonomously in an islanded mode [5], or connect to its host distribution system in a grid- connected mode [5], or as an interactive network with its neighboring microgrids and form a system of microgrids that does not physically connect to their host distribution system in a hybrid mode. Each microgrid is managed by the Microgrid Management System (µMS). In such a conﬁguration, the management burden of the DMS is signiﬁcantly reduced, as the DMS only needs to coordinate several µMS [3]–[6]. For an AC microgrid, frequency regulation is an important functional block in the µMS design, expecially when the microgrid enters the islanded or hybrid mode. Similar to bulk transmission systems, frequencies at the microgrid can be regulated in a hierarchical manner. The bottom layer of the frequency regulation entails local controllers in DERs, e.g., power controllers of inverter-based resources (IBRs), and governors of small synchronous generators. These local controllers are termed the primary control of microgrids [5], [6]. As the primary control can yield steady-state errors of frequencies from their nominal values after a disturbance, a secondary control layer is needed in microgrids to regain the nominal frequency [7], [8]. Since the secondary frequency regulation in AC microgrids shares a very similar objective with the Automatic Generation Control (AGC) of bulk trans- mission systems, we term the secondary frequency regulator in microgrids Micro-AGC (µAGC) to highlight its connection with the AGC that has served the bulk power systems for half of a century. This paper focuses on the µAGC design. There is a large body of literature that addresses the µAGC design. These design schemes can be generally categorized into centralized, distributed, and decentralized control [9]. Centralized µAGC relies on a monopolistic decision-making platform that gathers measurements from the DERs under control, computes regulation signals, and dispatches these signals to the DERs [10], [11]. Distributed µAGC employs co- operative control policies among neighboring DERs to achieve certain objectives. It can be further classiﬁed into three sub- groups: averaging-based methods [7], distributed-consensus- based methods [12], and event-triggering-based methods [13]. In decentralized µAGC design, each DER participating in the µAGC recovers its own nominal frequency to a nominal value independently. The washout ﬁlter is investigated in [14] and shown to be equivalent to a decentralized secondary control. In [15], a decentralized linear–quadratic regulator (LQR) control design is proposed to achieve frequency restoration in an arXiv:2208.11163v2 [eess.SY] 25 Apr 2023 2 optimal way. Another idea to achieve decentralized frequency regulation is based on state estimation. The estimation-based µAGC [16] employs the system states estimated locally instead of the true measurements to generate control signals. However, a system of microgrids equipped with the µAGC design mentioned above may be still vulnerable to physical disturbances and/or cyber anomalies. Compared with high- voltage transmission systems, a microgrid is more sensitive to physical disturbances, e.g., load/renewable power ﬂuctuations, and IBR connection and re-connection, due to its small scale and the zero/low inertia of its generation units [5], [17]. These disturbances cause large, and fast ﬂuctuations of microgrid fre- quencies. The frequency changes induced by the disturbances may not be captured in an accurate and timely manner by the frequency sensors (shall be shown in Section II-B). However, almost all the above-mentioned µAGC design schemes utilize frequency measurements to make decisions. It is assumed that the frequency information can be reported by DERs or it can be accurately measured in a fast manner. In practice, while the frequency information can be produced by the IBR power controller as a digital, internal control command [18], such a digital signal may not be available for a third-party µAGC1, and it can only be indirectly obtained by external frequency sensors. As a result, the desirable control performance of the µAGC relying on accurate frequency measurements might not be attained, especially with fast ﬂuctuations from renewable generation and load. Therefore, it is advantageous to develop a µAGC that does not depend on the frequency information when a microgrid enters the islanded or hybrid operating mode. Another important consideration for the µAGC design is the cyber security. While the distributed and decentralized µAGC schemes reduce the cyber risks of the µAGC by sparsifying or eliminating long-distance communication links among DERs, these µAGC schemes may be still susceptible to the false data injection (FDI) attack where the sensors can be manipulated to report wrong information to the µAGC. Many references concern attenuating the inﬂuence of the FDI attacks [19]. One category of methods explores state estimation techniques [20], for example, the Kalman ﬁlter method [21] and optimization- based state estimation methods [22]. These methods either rely on the accuracy of measurements or heavy computations [23]. To address these challenges, observer-based detection and control methods have been proposed [19], [24]. Recently, the unknown input observer (UIO) has found a broad range of applications in FDI attack detection and cyber-resilient control designs [25], [26] since it can separate the external disturbances from the attack signals, yielding a more sensitive anomaly diagnosis. However, these cyber security solutions are built upon existing µAGC designs that require accurate frequency information. It is an open-ended question whether these solutions can extend to other control designs that require different information other than frequencies. While some cyber attack solutions [27], [28] are designed for a general model that serves as an abstraction of many engineering systems, 1By the third-party µAGC, we mean that the µAGC service is not designed and implemented by the inverter manufacture. e.g., a state-space model, the model that should be used for the purpose of developing cyber solutions heavily depends on the information feeding its controller. For a speciﬁc controller, it might not be straightforward to derive a proper model that lends itself to the cyber solution design even for domain experts. Therefore, the development of µAGC and its cyber solution are interdependent. To overcome these challenges in this paper we introduce a co-design of µAGC and its cyber solutions. We identify the sensory challenges and cyber vulnerability facing the µAGC design. To address the sensory challenges, we introduce a new microgrid modeling approach by exploiting the structure of microgrid dynamics, i.e., the property of rank-one deﬁciency. Such a modeling approach leads to an optimal µAGC that is easily implemented, as it does not require fast frequency measurements that can be hard to obtain [29]. An end-to-end cyber security solution to FDI attack detection and mitigation is developed for the proposed µAGC. The front-end barrier of applying off-the-shelf algorithms for cyber attack detection is removed by introducing a data-driven modeling approach. Besides, we propose an observer-based corrective control for an islanded microgrid and a collaborative mitigation scheme in systems of AC microgrids. Compared with the existing µAGC design, the contribution of this paper is summarized as follows: 1) The proposed µAGC can regulate microgrid frequencies in the presence of both load/renewable power ﬂuctuations and FDI cyber attacks; 2) Compared with the µAGC design that requires internal digital signals of DERs or fast frequency measurements, the proposed µAGC is more practically im- plementable, as it only requires real-time real power which can be measured fast and accurately; 3) Compared with the method that is speciﬁcally designed for one type of DERs [15], the proposed µAGC design can address systems of microgrids with heterogeneous DERs; and 4) We demonstrate the role of systems of microgrids in terms of attenuating the inﬂuence of cyber attacks. The rest of this paper is organized as follows: Section II presents the challenges facing the µAGC design; Section III introduces the new microgrid modeling approach that is used for designing the µAGC in the presence of fast load/renewable power ﬂuctuations; Section IV demonstrates the cyber security solutions to the proposed µAGC; and Section V tests the proposed µAGC and its cyber security solutions. II. NEW MODELING FOR µAGC DESIGN This section starts with describing the dynamics of systems of microgrids in the conventional state space where voltage phase angles and frequencies are used as the state variables. Then we point out the limitations of conventional µAGC design. We derive a new model which lends itself to more robust µAGC with respect to measurement inaccuracies and cyber attacks. A. Conventional Microgrid Modeling for µAGC design We consider a microgrid with N IBRs and M loads. Without loss of generality, the IBRs are connected to the ﬁrst N nodes, and the loads and the point that networks with the 3 Fig. 1. A microgrid with N IBRs and M loads and the control scheme of IBRs. The control variables of loops 1 and 2 are voltage and current measurements from the LC ﬁlter, and the modulation index, respectively. neighboring microgrids locate at nodes N +1, . . . , N +M, as shown in Figure 1. The effect of the neighboring microgrids on the microgrid under study is modeled as load power injection. 1) Nodal dynamics: Without µAGC and load/renewable power ﬂuctuations, the primary control is designed such that the frequencies at all IBRs can be stabilized at ωnom which is the desired/nominal frequency (i.e., 314 or 377 rad/s). The dynamics of the power calculator at the i-th IBR is ˙δi = ωi −ωnom (1a) ˙Pi = −ωciPi + ωciPGi (1b) ωi = ωsi −mPiPi (1c) where δi is the internal voltage phase angle; ωi is frequency; PGi is the instantaneous real power component [18]; Pi is the real power ﬁltered by the digital ﬁlter; ωci is the cut- off frequency of the digital ﬁlter; ωsi is the setpoint; and mPi is the droop coefﬁcient. Equation (1a) is introduced by deﬁnition; and Equations (1b) and (1c) result from the digital ﬁlter dynamics and the droop characteristic [18]. Variables PGi, Pi, δi, and ωsi are annotated in Figure 1. Since ωi is the variable that is regulated by the µAGC, we eliminate Pi by noting ˙ωi = −mPi ˙Pi; Pi = (ωsi −ωi)/mPi. (2) The underlying assumption of (2) is that the change rate of setpoint ˙ωsi is much slower than ˙ωi, i.e., ˙ωsi ≈0. With (2), we obtain the following dynamics for the i-th IBR where ωi becomes a state variable: ˙δi = ωi −ωnom (3a) ˙ωi = −ωciωi + ωciωsi −mPiωciPGi. (3b) Denote by δ∗ i , ω∗ i , and P ∗ Gi the steady-state values of δi, ωi, and PGi, respectively. Suppose that there are no load/renewable power ﬂuctuations. If we need ωi to converge to ωnom, ωsi should be set to ω∗ si where ω∗ si = ωnom + mPiP ∗ Gi. Deﬁne ∆δi = δi −δ∗ i , ∆ωi = ωi −ω∗ i , ∆PGi = PGi −P ∗ Gi, and ∆ωsi = ωsi −ω∗ si. Use ∆xi = [∆δi, ∆ωi]⊤as a state vector. Then, Equation (3) becomes ∆˙xi = Ai∆xi + B1i∆ωsi + B2i∆PGi (4) where Ai = 0 1 0 −ωci  , B1i =  0 ωci  , B2i =  0 −mPiωci  . The dynamics for N IBRs can be described by ∆˙x = AG∆x + B1∆ωs + B2∆PG (5) where ∆x = [∆x⊤ 1 , . . . , ∆x⊤ N]⊤; ∆ωs = [∆ωs1, . . . ∆ωsN]⊤; ∆PG = [PG1, . . . , PGN]⊤; AG = diag(A1, . . . , AN); B1 = diag(B11, . . . , B1N); B2 = diag(B21, . . . , B2N). 2) Network Constraints: For the microgrid under study, its neighboring microgrids that can be networked with can be con- sidered power injection. For simplicity, real power and voltage magnitudes are assumed to be decoupled, i.e., the voltage magnitudes Vi for i ∈{1, . . . , N + M} is constant. The IBRs and loads are interconnected via microgrid network which introduces algebraic constraints for i ∈{1, 2, . . . , N + M}: PIi −V ∗2 i gii − N+M X k=1,k̸=i V ∗ i V ∗ k Yik cos(δik −θik) = 0 (7) where PIi is the net real injection to node i; gii denotes the self-conductance of node i; the admittance of the branch from the i-th to the k-th node is Yik∠θik; V ∗ i is the nominal voltage magnitude at node i; and δik is the voltage phase angle difference between nodes i and k, i.e., δik = δi−δk. Denote by {P ∗ Ii, Q∗ Ii, V ∗ i , δ∗ i |i = 1, 2, . . . , N +M} the operating condition that satisﬁes constraints (7). Deﬁne the following vectors ∆PI := [∆PI1, . . . , ∆PIN+M]⊤= [∆P⊤ G , ∆P⊤ L ]⊤ ∆δ := [∆δ1, . . . , ∆δN+M]⊤= [∆δ⊤ G , ∆δ⊤ L ]⊤ where ∆PIi and ∆δi are the deviations of PIi and δi from P ∗ Ii and δ∗ i , respectively; ∆PG = [∆PG1, . . . , ∆PGN]⊤; ∆PL = [∆PIN+1, . . . , ∆PIN+M]⊤; ∆δG = [∆δ1, . . . , ∆δN]⊤; ∆δL = [∆δN+1, . . . , ∆δN+M]⊤; and the subscript of “I” of ∆PIi stands for “Injection”. If ∆PIi and ∆δi for all i are small, the relationship between ∆PI and ∆δI can be described by ∆PI = H∆δ (9) where the entry h(i,k) at the i-th row and the k-th column of H ∈R(N+M)×(N+M) can be obtained via h(i,k) = V ∗ i V ∗ k Yik sin(δ∗ ik −θik) ∀k ̸= i h(i,i) = − N+M X p=1,p̸=i V ∗ i V ∗ p Yip sin  δ∗ ip −θip  . Equation (9) is equivalent to ∆PG ∆PL  = HGG HGL HLG HLL  ∆δG ∆δL  (11) where HGG ∈RN×N, HGL ∈RN×M, HLG ∈RM×N, and HLL ∈RM×M. Based on the above equation, ∆PG can be expressed as a function of ∆δG and ∆PL, i.e., ∆PG = (HGG −HGLH−1 LL HLG)∆δG + HGLH−1 LL ∆PL. (12) 4 3) System Dynamics: Plugging (12) into (5), we have ∆˙x = A∆x + B1∆ωs + F∆PL (13) where A = AG + B2(HGG −HGLH−1 LL HLG)E; and F = B2HGLH−1 LL . In the expression of matrix A, matrix E = diag(E1, . . . , EN) where Ei = [1, 0] for i = 1, . . . , N. It is worth noting that dynamics (13) directly establish the connec- tion between the frequency change ∆ωi and the load/tie-line ﬂow ﬂuctuations ∆PL. 4) Two Common Assumptions for Conventional µAGC De- sign: The objective of µAGC is to drive the frequency devi- ations {∆ωi|i = 1, . . . , N} to zero by tuning the setpoints of IBRs ωsi in the presence of load/renewable power ﬂuctuations ∆PL. With such an objective, a centralized µAGC typically tunes the setpoints ωs of the IBRs under control by measuring the frequency at a critical node. A decentralized/distributed µAGC observes its local frequency and other variables, e.g., local real power PGi, to tune its local setpoint ωsi. Note that these µAGC design schemes are generally built upon at least one of the following two assumptions: 1) An IBR can report its true frequency ωi to its µAGC, or ωi can be measured accurately by external sensors; and 2) The measurements feeding the secondary controllers are authentic. However, it is possible that neither assumption holds in practice. This will be elaborated in the following two subsections. B. Sensory Challenges of µAGC Design The frequency ωi is used as an input for many conventional µAGC to tune the setpoint ωsi. For a commercial inverter, this variable is an internal, digital control command that might not be accessible for a third-party µAGC. One alternative solution in order to obtain ωi is to measure the frequency of the fundamental component of terminal voltage at the i-th IBR. However, it is challenging to measure frequency both fast and accurately in practice. Figure 2 shows the sensory challenges when actual frequency changes fast and the frequency is required to be measured fast. In Figure 2, the orange lines represent the true frequency of three-phase sinusoidal waves, while the blue curves shows the frequencies measured by a Simulink Phasor Measurement Unit (PMU) block [30]. In Figure 2(a), the true frequency changes at the 1-st second, the measured frequency converges to the true frequency. The measurement error is acceptable if the PMU reports the frequency at a slow rate, say 10 samples per second (10 Hz). However, large measurement errors may exist from time t = 1 s to t = 1.1 s, if frequency is required to be reported every 0.01 seconds (100 Hz). Furthermore, as shown in Figure 2(b), if the frequency keeps ﬂuctuating, the large measurement errors can persist when a high sampling rate, say, 100 Hz, is required. One obvious question is why a high sampling rate of measurements is necessary for µAGC, compared with the conventional AGC in bulk transmission systems which issues control commands every 2-4 seconds [31], [32]. The reason is that the fast, large frequency ﬂuctuations are more pronounced in small systems like microgrids than in the bulk transmission systems. Similar to the bulk transmission systems, there are 0.95 1 1.05 1.1 1.15 1.2 1.25 1.3 49.9 49.95 50 50.05 50.1 50.15 50.2 50.25 50.3 measured true (a) 0.95 1 1.05 1.1 1.15 1.2 1.25 1.3 49.9 49.95 50 50.05 50.1 50.15 50.2 50.25 50.3 measured true (b) Fig. 2. (a) The true frequency can be measured if it changes slowly; (b) The true frequency cannot be accurately measured if it changes fast. volatile loads/renewables that keep perturbing the microgrid, which cause the microgrid frequencies to keep ﬂuctuating. Compared with the transmission systems, the microgrid is more sensitive to these disturbances due to its smaller scale and the low inertia of its DERs [5]. As a result, the microgrid frequencies may have large, fast ﬂuctuations. To regulate the microgrid frequencies to their nominal values, the rate of issuing control commands should be much faster than the rate at which disturbances change. Otherwise, the frequencies may not be regulated. To issue the fast control commands, the fast and accurate measurements are needed. Since the frequency cannot be measured accurately in a fast manner, a conven- tional µAGC that takes measured frequency as inputs cannot achieve its desirable control performance. This motivates us to design a fast µAGC without using the fast measurements of frequencies. The solution that addresses the sensory challenge is presented in Section III. C. Cyber Vulnerability of µAGC A third-party µAGC coordinates IBRs based on sensor measurements. Figure 3 shows the communication architec- ture of the proposed µAGC where the sensors that measure electrical variables send their measurements to µAGC via a Wide Area Network (WAN) [33]. Various protocols can be applied to the WAN to establish wireless communication between the sensors and µAGC (See [33] for more details of the protocols). FDI attacks can be launched by intruding into the WAN and/or manipulating the sensors. For most wireless communication, license-free ISM (industrial, scientiﬁc, and medical) radio band is used [33]. As a result, the bandwidth can be legally accessed by attackers who aim to tamper with the information transmitted through the communication channel [33]. The risks of such a type of attacks can be reduced by latest cryptographic mechanisms [33]. This paper focuses on the FDI attacks launched via the sensors shown in Figure 3. Such a type of attacks is feasible in real world. For example, Reference [34] has designed and demonstrated a device that can introduce FDI attack on Hall sensors in a non-intrusive manner by changing an external magnetic ﬁeld. If such cyber attacks occur in the sensors shown in Figure 3, all control commands from the µAGC can compromise the safety and efﬁciency of the microgrids. For example, a cyber attacker can blind the µAGC by launching a replay attack, i.e., the actual measurements y is replaced by a sequence of pre-recorded y 5 [31]. As another example, an adversary may compromise the efﬁciency of the µAGC by superposing random noise upon the actual measurements y. Such a FDI attack is termed the noise injection attack [31]. A large body of literature presents cyber attack models and objectives in the context of power grids (see [35], [36] and the references therein) and power electronics devices (See [37] and the references therein). A key question is how to design the µAGC that is resilient to the FDI attacks on the information feeding the µAGC. Section IV proposes a potential answer to this question. Fig. 3. Communication architecture of a centralized µAGC III. FAST MICRO-AUTOMATIC GENERATION CONTROL This section introduces a new model that exploits the rank- deﬁciency property of the microgrid dynamics and describes the microgrid behaviors in a new state space. Such a model lends itself to address the sensory challenge in the presence of fast load/renewable power ﬂuctuations. Based on the model in the new space, we introduce a fast µAGC for a system of microgrids. A. New State Space Modeling of Microgrid Dynamics We describe the microgrid dynamics in a new state-space by exploiting the rank-deﬁciency property of the system matrix Ai in (4). Such a property is used for analyzing bulk trans- mission systems in our previous work [38], [39]. It is obvious that Ai is rank deﬁcient, i.e., one of eigenvalues of Ai is zero. Denote by Ti ∈R1×2 the left eigenvector associated with the zero eigenvalue of matrix Ai. By deﬁnition, we have TiAi = 0. One choice of Ti is Ti = [ωci, 1]. (14) Deﬁne a scalar zi as follows: zi := Ti∆xi. (15) Multiplying both sides of (4) by Ti, we obtain ˙zi = ωci∆ωsi −mPiωci∆PGi. (16) Here, we show that the scalar zi lends itself to design a fast µAGC. The reason lies in the following two observations: • Observation 1: zi reﬂects the frequency regulation ob- jective: a zero ˙zi implies that ∆ωi tends to zero. • Observation 2: Computing zi only requires PGi, sug- gesting that zi can be obtained in a fast manner. Observation 1 results from Equations (4) and (16) that lead to ∆˙ωi = −ωc∆ωi + ˙zi. (17) With a zero ˙zi, ∆ωi(t) tends to zero, as time t tends to inﬁnity, given any intial condition ∆ωi(0). This is because the scalar system ∆˙ωi = −ωc∆ωi is asymptotically stable, where ωc > 0. Observation 1 essentially connects the frequency regulation with the scalar zi, and it suggests that the frequency at the i-th IBR can be regulated, if the corresponding ˙zi equals 0. Observation 2 is obtained by integrating both sides of (16): zi(t) = ωci Z t 0 (∆ωsi(τ) −mPi∆PGi(τ)) dτ + zi(0) (18) where ∆ωsi is the control command produced by the sec- ondary controller; ∆PGi can be measured; and the initial con- dition zi(0) can be set to zero for engineering implementation. Essentially, (18) suggests that if the µAGC makes deci- sions by observing zi in the presence of fast load/renewable power ﬂuctuations, measuring fast ∆PGi sufﬁces, and it is unnecessary to have fast frequency measurements. A natural question is: Compared with frequency, why can the instan- taneous power ∆PGi be measured both fast and accurately? In practice, frequency and instantaneous power are computed based on instantaneous voltage and current measurements. The instantaneous voltage (current) can be measured by a voltage (current) transducer. After being ﬁltered by a low- pass ﬁlter, the analog signal of the voltage (current) can be digitized by an analog-to-digital circuit [40]. With the digital voltage/current signal, the frequency of the voltage/current can be estimated by various algorithms [41], e.g., phase-locked loops [42], discrete Fourier transform [41], and least-squares techniques [43]. Before these signal processing techniques accurately track the true frequency, there exists a transient process where the frequency estimated does not match the true frequency. The waveform from 1 sec. to 1.15 sec. in Figure 2(a) of the manuscript shows such a transient process. As shown in Figure 2(b), the concern is that when the true frequency changes during the sensor transient process, these signal processing techniques cannot accurately estimate the frequency anymore. However, with the digital voltage and cur- rent signals with a high sampling rate (e.g., 30.7 kHz [44]), the instantaneous power can be computed almost instantaneously using an algebraic equation2. The operation of computing the instantaneous power will not incur the transient process that appears when the frequencies are computed. Therefore, the instantaneous power can be measured accurately, even when the true power ﬂuctuates fast. The sensory bottleneck described in Section II-B is overcome by introducing a new variable zi. It is worth noting that the modeling approach is applicable to other types of DERs that possesses the rank-one deﬁciency property. This is because this rank deﬁciency is a direct conse- quence of conservation of energy [38], [39]. Our earlier work [45] addresses synchronous machines using the same modeling 2The algebraic equation is the deﬁnition of the instantaneous three- phase power p3φ: p3φ(t) = va(t)ia(t) + vb(t)ib(t) + vc(t)ic(t) where {va, vb, vc} and {ia, ib, ic} are the instantaneous, three-phase voltages and currents, respectively. 6 approach. Such a modeling approach lends itself to a µAGC design for microgrids with heterogeneous energy resources. The µAGC design for such a kind of microgrids cannot be formulated by some control methods that are speciﬁcally designed for IBRs, such as [15]. B. Optimal Frequency Regulation This subsection introduces an optimal µAGC that tunes the IBR setpoints ∆ωi by observing the scalars zi. To drive the frequency deviations to zero, based on Observation 1, one possible control law is ∆ωsi = mPi∆PGi ∀i = 1, . . . , N. (19) According to (16), the control law (19) leads to a zero ˙zi. It follows that ∆ωsi tends to zero, based on Observation 1. It is worth noting that the control law (19) can be imple- mented in a decentralized manner, as the setpoint for the i- th IBR is computed only by its local measurement PGi for i = 1, 2, . . . , N. However, the decentralized control law (19) might not achieve high economical efﬁciency, since different IBRs incurs different generation costs. For example, we may expect the cheaper IBRs to generate more real power in order to regulate the microgrid frequencies. Therefore, coordination among IBRs is needed in order to regulate frequencies at the minimal costs. Such coordination is achieved by formulating the frequency regulation problem into the following optimal control problem in the zi space: min ∆ωs 1 2 Z ∞ 0  z(t)⊤Qz(t) + ∆ωs(t)⊤R∆ωs(t)  dt s.t. ∆˙x(t) = A∆x(t) + B1∆ωs(t) (20) where z = [z1, . . . , zN]⊤; matrices Q ∈RN×N and R ∈ RN×N are positive deﬁnite. In the frequency regulation prob- lem in this paper, both matrices Q and R are diagonal. Denote by qi and ri the i-th diagonal entry of Q and R, respectively. A relatively large qi suggests relatively higher quality of service is required by the end users at node i. A relatively large ri suggests a relatively higher generation cost at the i-th IBR. Based on transformation (14), z can be expressed in terms of states ∆x in the conventional space z = T∆x (21) where T = diag(T1, . . . , TN). Plugging (21) into the objective function of the optimization (20) gives the standard formula- tion of the LQR problem: min ∆ωs 1 2 Z ∞ 0  ∆x(t)⊤Q′∆x(t) + ∆ωs(t)⊤R∆ωs(t)  dt s.t. ∆˙x(t) = A∆x(t) + B1∆ωs(t) (22) where Q′ = T ⊤QT. The solution to (22) has the following form: ∆ωs = −K′∆x, where K′ can be obtained a process that has been standardized in some software toolboxes, e.g., the function lqr in MATLAB. As discussed earlier, it is more desirable to feed µAGC the transformed states z, rather than ∆x which includes the frequency deviation ∆ωi that is hard to measure at a fast rate. Therefore, the control law is ∆ωs = −Kz. (23) where matrix K is chosen such that Kz ≈K′∆x, and one possible choice of K is K = K′T ⊤(TT ⊤)−1 [39]. Note that the control law (23) tunes ∆ωs by observing z or by measuring PGi for i = 1, 2, . . . , N. Such a control law is immune to the FDI attacks on frequency or phase angle measurements. However, it is vulnerable to cyber attacks on PGi. The cyber vulnerability of the control law (23) is addressed in the following section. IV. CYBER ANOMALY DETECTION AND CORRECTION To compute z, the real power PGi for all IBRs is needed to be measured and reported to a µAGC. It is possible that a malicious adversary can compromise the microgrid by launching the FDI attacks (described in Section II-C) on the PGi. If this happens, the control command ∆ωs issued by the µAGC may fail to stabilize or to regulate the frequency, compromising the microgrid’s safety and the quality of elec- tricity service. This section introduces an end-to-end scheme that can enhance the microgrid resilience to cyber attack on the critical measurements. The key idea of the scheme is to leverage a computational model that represents the dynamics of the microgrid, for the purpose of predicting PGi. The main challenge is how to obtain the computational model that bridges the healthy information ∆ωs to PGi that might be under cyber attacks. We ﬁrst present the computational model that serves as the prerequisite of applying existing cyber attack detection algorithms. Next, we propose a strategy that can mitigate the impact of cyber attacks. A. Computational Model for Cyber Attack Mitigation Without load/renewable power ﬂuctuations, the real power ∆PG used for computing z in (23) can be predicted by ∆ωs according to the following discrete state space model with the sample time ∆t: ˆx[k] = A′ˆx[k −1] + B′∆ωs[k −1] (24a) ∆ˆPG[k] = C′ˆx[k] (24b) where ∆ˆPG is the predicted version of ∆PG[k]; ˆx[k] is an intermediate variable which can be obtained by using (24a) recursively if ˆx[0] is given; and A′, B′, and C′ are the system, input, and output matrices. One challenge of using (24) to predict ∆PG is how to obtain the matrices A′, B′, and C′. We leverage a system identiﬁcation technique (i.e., N4SID [46]) to learn these matrices using the experimental measurements of ∆ωs and ∆PG. Implementing the N4SID technique requires: 1) input- output data; and 2) the order of the system (24). 1) Input-output data: Deﬁne a rectangular function rect(t) as follows rect(t) = 1t≥0 −1t−∆t′≥0 (25) where ∆t′ > ∆t denotes the width of the rectangular pulse; and 1t≥0 is an indicator function, i.e., 1t≥0 = ( 1 t ≥0 0 t < 0. 7 The input signal ∆ω′ s[k] for system identiﬁcation can be sampled from the following continuous function with sampling time ∆t l(t) = ⌈t/∆t′⌉ X k=0 αkrect(t −k∆t′) (26) where ⌈·⌉is the ceiling function; the random scalar αk is uniformly distributed in [−β, β] whence β is a small positive scalar. By feeding the microgrid the designed setpoint se- quence S = {∆ω′ s[k]|k = 0, 1, . . . , K0}, the response of ∆PG can be measured at sample time ∆t. The input sequence S associated with the ∆PG’s response is used for implementing the N4SID technique. 2) Order Selection: The optimal system order d∗is ob- tained by trial and error. Suppose that there a set D that collects some candidate system orders, say, D := {1, 2, . . . , 10}. For d ∈D, the N4SID technique can return the identiﬁed A′, B′, and C′. With these matrices and the input data O, ∆PG’s prediction ∆ˆPGd can be computed. The performance of the identiﬁed system with the order d can be quantiﬁed by ηd = 1 K0 + 1 K0 X k=0 ∆ˆPGd −∆PG 2. (27) The optimal order d∗is chosen such that the smallest ηd is attained, viz., η∗= arg mind∈D ηd. B. Cyber Attack Detection The state-space model (24) can be used in some cyber attack detection algorithms, e.g., the dynamic watermarking approach [27], and the UIO method [25]. As an example, we show how to use the dynamic watermarking approach to detect cyber attacks on PGi. Figure 4 shows the basic idea of the dynamic watermarking approach. A small, secret watermark signal e[k] ∈RN is superposed upon the IBRs’ setpoints ∆ωs at each time step k. The watermark signal possesses some known statistics, e.g. e[k] ∼N(0, Σ) where matrix Σ is the covariance matrix of e[k]. The watermark e[k] impacts the measurement of ∆PG. As a result, an authentic measurement of ∆PG should reﬂect the statistical properties concerning the watermark e[k]. By subjecting the measurements of ∆PG to certain statistical tests, a wide range of cyber attacks on the measurement of ∆PG can be detected [27], [31]. The detailed mechanism of the dynamic watermarking ap- proach is elaborated as follows. Denote by ∆P′ G the measure- ments of the real power ∆PG that are received by the µAGC. If there are no cyber attacks on ∆PG, ∆P′ G = ∆PG, with the true sequence of {∆ωs[i]} and {e[i]} for i = 0, 1, . . . , k −1, one can approximately predict ∆PG[k] based on ˆx[k] = A′ˆx[k −1] + B′(∆ωs[k −1] + e[k −1]) (28a) ∆ˆPG[k] = C′ˆx[k]. (28b) Deﬁne ν[k] := ∆P′ G[k] −∆ˆPG[k]. (29) For a microgrid without cyber attack, i.e., ∆P′ G[k] = ∆PG[k], we can obtain a long sequence {∆P′ G[k]|k = 1, . . . , W} where W is a large integer. The expectation µ∗ ν and covariance matrix Σ∗ ν of ν in the microgrid without cyber attack can be approximated by ˆµ∗ ν and ˆΣ∗ ν where ˆµ∗ ν = 1 W W X k=1 ν[k] (30a) ˆΣ∗ ν = 1 W W X k=1 (ν[k] −ˆµ∗ ν)(ν[k] −ˆµ∗ ν)⊤. (30b) For the microgrid that might be under cyber attacks where ∆P′ G[k] may not be equal to ∆PG[k], denote by ˆµν and ˆΣν the estimated expectation and covariance matrix of ν, respectively. Let Mρ and ˆ Mρ collect ∆P′ G and its prediction ∆ˆPG from time t = (ρ −W + 1)∆t to t = ρ∆t, viz., Mρ := {∆P′ G[k]|k = ρ −W + 1, . . . , ρ} (31a) ˆ Mρ := {∆ˆPG[k]|k = ρ −W + 1, . . . , ρ}. (31b) ˆµν and ˆΣν can be estimated from Mρ and ˆ Mρ via ˆµν = 1 W ρ X k=ρ−W +1 ν[k] (32a) ˆΣν = 1 W ρ X k=ρ−W +1 (ν[k] −ˆµν)(ν[k] −ˆµν)⊤. (32b) If ∆P′ G[k] = ∆PG[k], ˆµν and ˆΣν should be close to ˆµ∗ ν and ˆΣ∗ ν, respectively, that is, ξ1 = ∥ˆµν −ˆµ∗ ν∥2 < ϵ1 (33a) ξ2 = |tr(ˆΣν −ˆΣ∗ ν)| < ϵ2 (33b) where ∥·∥2 and tr(·) are the L2 norm and the trace operator, respectively; and ϵ1 and ϵ2 are positive numbers. Violation of either (33a) or (33b) or both suggests cyber attacks, i.e., ∆PG[k] ̸= ∆P′ G[k]. The two conditions in (33) can be checked in a moving-window fashion, which is summarized in Algorithm 1. Function DW in Algorithm 1 returns a binary result: “flag = 0” suggests that a cyber attack is not detected, while “flag = 1” suggests that cyber attack is detected. Algorithm 1 Watermarking-based Cyber Attack Detection 1: function DW(Mρ−1, ˆ Mρ−1, ∆P′ G[ρ], ∆ωs[ρ], e[ρ], ˆx′[ρ− 1], A′, B′, C′, ˆµ∗ ν, ˆΣ∗ ν, ϵ1, ϵ2) 2: Compute ∆ˆPG[ρ], ˆx by (28) 3: ˆ Mρ ← n ∆ˆPG[ρ] o ∪ˆ Mρ−1 − n ∆ˆPG[ρ −W] o 4: Mρ ←{∆P′ G[ρ]} ∪Mρ−1 −{∆P′ G[ρ −W]} 5: Compute ˆµν, ˆΣν using Mρ, ˆ Mρ based on (29), (32) 6: Obtain ξ1 and ξ2 according to (33) 7: if (ξ1 < ϵ1) ∧(ξ2 < ϵ2) then 8: flag ←0 ▷No attack is detected 9: else 10: flag ←1 ▷Attack is detected 11: end if 12: return flag, Mρ, ˆ Mρ, ˆx′[ρ] 13: end function 8 Fig. 4. Basic idea of the dynamic watermarking approach C. Corrective Control This subsection addresses how to regulate frequency under cyber attacks on the real power measurements ∆PG feeding the proposed control law (23). Depending on whether there are microgrids that can be networked with the microgrid under cyber attacks, the µAGC under cyber attack can select one of the following two schemes to regulate frequencies. 1) Observer-based Correction Scheme: Once the cyber at- tack is detected and there is no neighboring microgrid that can be networked with the microgrid under attack, the microgrid attacked can use the observer-based correction scheme to regulate its frequencies. The basic idea of such a scheme is to leverage an observer to predict the real power measurement ∆PG and to use the prediction ∆ˆPG to tune the setpoints ∆ωs of IBRs. Speciﬁcally, the observer is deﬁned in (24) [47]. The control law in the observer-based correction scheme is ∆ωs = −K  ˆz1, ˆz2, . . . , ˆzN ⊤. (34) where ˆzi(t) = ωci R t 0  ∆ωsi(τ) −mPi∆ˆPGi(τ)  dτ. 2) Collaborative Correction Scheme: The control law (19) is blind to load/renewable power ﬂuctuations. As a result, the frequencies cannot be regulated at the nominal frequency if ∆PL ̸= 0. This issue can be addressed by the collabo- rative correction scheme presented here. Suppose that there are two islanded microgrids. Each microgrid has its own µAGC designed based on the control law (23). Assume that µAGC1 (µAGC2) is for Microgrid 1 (Microgrid 2). Suppose that microgrid 1 is under cyber attack on its ∆PGi that is used for computing zi. Once the cyber attack is detected at Microgrid 1 by some cyber attack detection algorithms, e.g., the dynamic watermarking approach, µAGC1 will be disabled, and Microgrid 1 can be networked with Microgrid 2 by closing the tie line between Microgrids 1 and 2. As will be shown in Section V, µAGC2 can regulate the frequencies at all nodes of both Microgrids 1 and 2, while µAGC2 makes decisions only based on the local measurements at Microgrid 2. The overall procedure described throughout Sections III and IV is summarized in Algorithm 2 where set Iρ−1 collects the input for the function DW in Algorithm 1, i.e., Iρ−1 :={Mρ−1, ˆ Mρ−1, ∆P′ G[ρ], ∆ωs[ρ], e[ρ], ˆx′[ρ −1], A′, B′, C′, ˆµ∗ ν, ˆΣ∗ ν, ϵ1, ϵ2}. (35) V. CASE STUDY In this section, the proposed fast µAGC and the associated cyber anomaly detection and correction scheme are tested in a microgrid with three IBRs via Simulink simulations. We ﬁrst Algorithm 2 Cyber Resilient µAGC 1: MW ←∪W k=1{∆P′ G[k]} 2: while ρ = W + 1, W + 2, . . . do 3: flag, Mρ, ˆ Mρ, x′[ρ] ←DW(Iρ−1) 4: if flag = 0 then 5: Compute ∆ωs[ρ] via (18) and (23) 6: else 7: if Neighboring microgrids are unavailable then 8: Compute ∆ωs[ρ] via (24) and (34). 9: e[ρ] ←0 ▷Stop injecting watermark 10: else 11: ∆ωs[ρ] ←0; e[ρ] ←0 12: Network with the neighboring microgrids 13: end if 14: end if 15: return ∆ωs[ρ] 16: end while Fig. 5. Physical and cyber architecture of two networked microgrids provide a brief description for the software-based microgrid testbed. Then we show the performance of the fast controller that exploits the rank deﬁciency property of IBRs, under fast renewable/load power ﬂuctuations. Finally, we present the performance of the cyber attack detection and correction scheme that is built upon the model developed in Section IV. A. Description of Software-based Microgrid Testbed Figure 5 illustrates the physical and cyber architecture of two networked microgrids that are used to test the pro- posed algorithms. For each IBR, its power calculator, voltage controller, current controller, and output ﬁlter are modeled according to [18]. All IBRs have the same parameters. Loads 1, 2, and 3 are modeled by resistors with the values of 25 Ω, 20 Ω, and 33 Ωfor each phase. There is a tie line that can network Microgrid 1 with Microgrid 2. The line parameters are annotated in Figure 5. Each microgrid has its own µAGC which tunes the setpoint of each IBR in the local microgrid. 9 B. Control Performance without Cyber Attack Here the performance of the controller (23) is tested. The secondary controller µAGC1 takes real power measurements PGi every 5 ms and issues control commands ωsi at the same rate, for i = 1, 2, 3. The tie line in Figure 5 is open. 1) Control Performance with Fast Renewable Fluctuations: Suppose Load 1 varies periodically and Figure 6 shows the real power ﬂowing to Load 1. The spikes in Figure 6(a) show the load changing transients, and the zoomed-in version of one of the spikes is shown in Figure 6(b). As a result, the frequencies at the three nodes of Microgrid 1 ﬂuctuate periodically. This can be observed via the orange dashed curves in Figure 7. The blue curves in Figure 7 show the frequencies at the three nodes with fast load/renewable power ﬂuctuations, when the proposed µAGC1 is enabled. It can be seen that the magnitudes of the frequencies’ ﬂuctuations are signiﬁcantly reduced by the proposed µAGC under load/renewable power ﬂuctuations. 2) Comparison: The proposed µAGC is compared with a slow LQR µAGC and a fast proportional–integral (PI) µAGC. The slow µAGC issues control commands every 0.1 s, while the two fast µAGC issues control commands every 5 ms. Figure 8 summarizes the comparison results in response to the load power ﬂuctuations shown in Figure 6. In Figure 8, the orange dotted curves are the frequencies under the slow µAGC. It can be observed that the frequencies cannot be regu- lated. This is not surprising because the time interval between two successive control commends is the same as that between two successive disturbances. The yellow dashed curves are the frequency response with the fast PI µAGC. Since the fast frequency changes cannot be measured accurately, the fre- quencies under the fast PI controller still cannot be regulated. As the proposed µAGC does not rely on the availability of fast frequency measurements, the frequencies can be regulated tightly around 50 Hz under the fast load/renewable power ﬂuctuations, as it is shown by the blue curves in Figure 8. C. Cyber Attack Detection and Corrective Control The proposed scheme for cyber resilient frequency regulator is tested under both renewable/load power ﬂuctuations and cyber attacks. 1) Cyber Attack Detection: One prerequisite for imple- menting Algorithm 1 is that the matrices A′, B′, and C′ are available. In this paper, these matrices are learned from the measurements of ∆ωs and ∆PG based on the system 0.5 1 1.5 0.2 0.4 0.6 0.8 1 1.2 1.4 1.6 1.8 104 (a) 0.799 0.8 0.801 0.802 0.803 3000 4000 5000 6000 7000 8000 9000 10000 (b) Fig. 6. (a) Real power measurement PL1 at load 1; and (b) zoomed-in version of PL1 from time t = 0.799 sec. to t = 0.803 sec. identiﬁcation procedure. It takes 1.43 seconds to decide the optimal order d∗and to learn the discrete model ofﬂine using a MacBook Pro with a 2.6 GHz Dual-Core Intel i5 Processor. The sampling rate of the discrete model is 0.005 seconds. The computation time of learning the models with different orders are shown in Figure 9(a). Next, we show the performance of the model learned by changing the setpoint of one IBR. Without the load/renewable power ﬂuctuations, the set point ∆ωs1 has a step change at time t = 0.7 s. The blue curve in Figure 9(b) represents the evolution of the measurements on PG1 under the step change. With the model learned, the evolution of PG1 can be predicted almost instantaneously. The orange dashed curve in Figure 9(b) represents the prediction. These two curves in Figure 9(b) almost overlap with each other, suggesting that the state-space model learned can ac- curately predict the response of the real power measurements PG1. The performance of Algorithm 1 is tested under the noise injection attack and the replay attack. In the simulation, W in Algorithm 1 is set to 100. Figures 10 and 11 show the performance of Algorithm 1 under the noise injection attack. In Figure 10(a), the noise injection attack on PG1 is launched at time t = 2 s. Such an attack causes the attack indicator ξ2 to shoot up and triggers the cyber attack alarm. In Figure 11(a), a temporary noise injection attack starts at t = 2 s and ends at t = 2.2 s. As shown in Figure 11(b), it takes around 0.025 seconds for the indicator to exceed its normal peak value, after the attack occurs. After the attack disappears, it takes around 0.485 seconds for the indicator to fall below its normal peak value. Figure 12 illustrates the performance of of Algorithm 1 under the replay attack. A replay attack on the PG1 occurs at time t = 2 s. Figure 12(a) shows the PG1 measurements under such an attack. From Figure 12(a), it is hard to determine when the cyber anomaly occurs by simply eyeballing the PG1 measurement curve. However, Figure 12(b) which shows the evolution of the attack indicator ξ2 explicitly suggests that the attack occurs around t = 2 s. 2) Observer-based Cyber Attack Correction: Figure 13 demonstrates the performance of the observer-based corrective controller. The noise injection attacks occur at the sensor measuring PG1 at Microgrid 1 at t = 0.7 s. Consequently, frequencies at the three nodes of Microgrid 1 become noisy. At t = 1 s, the observer-based corrective controller is enabled, and the frequencies are stabilized. 3) Collaborative Cyber Attack Correction: The observer- based corrective control is blind to renewable/load power ﬂuctuations. If Microgrid 2 is available, once cyber attacks at Microgrid 1 are detected, Microgrid 1 can disable µAGC1 and turn on the switches of the tie line that connects Microgrid 2. The µAGC2 can regulate the frequencies of both Microgrids 1 and 2. Figure 14 illustrates such a process. Suppose that at t = 0.5 s, µAGC1 is disabled due to a cyber attack detected. Load 1 also increases at t = 0.5 s, leading frequencies at Microgrid 1 to decrease. To recover the frequencies to 50 Hz, Microgrid 1 networks with Microgrid 2 via the tie line at t = 0.7 sec. It can be seen from Figure 14 that the three frequencies at Microgrid 1 are brought back to 50 Hz, and the event of networking Microgrids 1 and 2 only causes negligible 10 0.5 1 1.5 49.96 49.97 49.98 49.99 50 50.01 50.02 50.03 proposed control no control (a) 0.5 1 1.5 49.96 49.97 49.98 49.99 50 50.01 50.02 50.03 proposed control no control (b) 0.5 1 1.5 49.96 49.97 49.98 49.99 50 50.01 50.02 50.03 proposed control no control (c) Fig. 7. Frequencies at (a) node 1, (b) node 2, and (c) node 3 with and without the proposed µAGC. 1.5 1.6 1.7 1.8 1.9 2 49.96 49.97 49.98 49.99 50 50.01 50.02 50.03 proposed control slow LQR control fast PI control (a) 1.5 1.6 1.7 1.8 1.9 2 49.96 49.97 49.98 49.99 50 50.01 50.02 50.03 proposed control slow LQR control fast PI control (b) 1.5 1.6 1.7 1.8 1.9 2 49.96 49.97 49.98 49.99 50 50.01 50.02 50.03 proposed control slow LQR control fast PI control (c) Fig. 8. Comparison of the proposed µAGC, the slow LQR-based controller, and the fast PI controller: frequencies at Nodes 1 (a), 2 (b), and 3 (c). 1 2 3 4 5 6 7 8 9 10 0 0.05 0.1 0.15 0.2 0.25 (a) 0.5 1 1.5 4300 4400 4500 4600 4700 4800 4900 5000 Measurement Predicted (b) Fig. 9. (a) Computation time of the data-driven approach with different model orders; and (b) Actual measurements and predicted measurements 1.5 2 2.5 3 3700 3800 3900 4000 4100 4200 4300 (a) 1.5 2 2.5 3 1.05 1.1 1.15 1.2 1.25 1.3 1.35 1.4 1.45 104 (b) Fig. 10. Detection of the noise injection attack: (a) the real power measure- ment PGi in the time domain; and (b) the evolution of cyber attack indicator ξ2. frequency ripples at Microgrid 2. µAGC2 only serves as a temporary frequency regulator for Microgrid 1 when Microgrid 1 is under cyber attacks. Suppose that µAGC1 for Microgrid 1 is disabled, and µAGC2 for Microgrid 2 is enabled. Load at node 1 ﬂuctuates fast according to Figure 6. Figure 15 compares frequencies with 1.5 2 2.5 3 3700 3800 3900 4000 4100 4200 (a) 1.5 2 2.5 3 1.05 1.1 1.15 1.2 104 (b) Fig. 11. Detection of the temporary noise injection attack: (a) the real power measurement PGi in the time domain; and (b) the evolution of cyber attack indicator ξ2. 1.5 2 2.5 3 3700 3800 3900 4000 4100 4200 (a) 1.5 2 2.5 3 1 2 3 4 5 6 7 104 (b) Fig. 12. Detection of the replay attack: (a) the real power measurement PGi in the time domain; and (b) the evolution of cyber attack indicator ξ2. and without the collaborative control. It can be seen that while µAGC2 does not play a big role of regulating the frequency at node 1, it indeed improves the frequency proﬁles at nodes 2 and 3 by limiting the frequencies of nodes 2 and 3 within a narrower range. Figure 16 shows that µAGC2 can regulate the frequencies at IBRs 4 and 5 tightly around 50 Hz in the 11 0.5 1 1.5 49.98 49.99 50 50.01 50.02 50.03 Node 1 Node 2 Node 3 Fig. 13. Performance of the observer-based controller 0.5 1 1.5 49.96 49.98 50 50.02 50.04 50.06 Node 1 Node 2 Node 3 (a) 0.5 1 1.5 49.996 49.997 49.998 49.999 50 50.001 50.002 50.003 Node 4 Node 5 (b) Fig. 14. Performance of collaborative corrective control scheme: (a) frequen- cies at microgrid 1 under cyber attack; and (b) frequencies at microgrid 2. presence of fast load ﬂuctuations at node 1. Since the control performance of enabling µAGC2 alone is not as good as that of enabling both µAGCs, both µAGCs should be enabled if no cyber attacks are detected. It is worth noting that with µAGC1 disabled, µAGC2 can still regulate frequencies in Microgrid 1 under slow load ﬂuctuations. Figure 17 shows the frequencies at IBRs 1, 2, and 3 with the load at node 1 that changes every 2 s, when µAGC1 is disabled. It can be observed that the frequencies at IBRs 1, 2, and 3 are tightly regulated around their nominal values by µAGC2 under the slow load ﬂuctuations at node 1. The performance of the collaborative control can be justiﬁed by examining ∆PGi in (16). When the load at node 1 increases at 1 s and the two microgrids are networked, Figure 18 visualizes ∆PGi for i = 1, 2, . . . , 5. In Figure 18-(a), it can be observed that the steady-state values of ∆PGi for i = 1, 2, 3 return zero, which means that no extra real power is produced by IBRs that do not participate in µAGC2, i.e., IBRs 1, 2 and 3, in order to balance the increased amount of load. The increased amount of load is balanced by the IBRs that participate in µAGC2, i.e., IBRs 4 and 5. Since IBRs 1, 2 and 3 do not participate in µAGC2, ∆ωsi = 0 for i = 1, 2, 3. In addition, Figure 18-(a) shows ∆PGi = 0 for i = 1, 2, 3 in steady state. Based on (16), ˙zi equals zero for i = 1, 2, 3. Because of Observation 1, ∆ωi is zero in steady state for i = 1, 2, 3. This explains why the frequencies in Microgrid 1 is regulated by µAGC2, while µAGC2 does not take any measurements from Microgrid 1. Note that such performance of the collaborative control is built upon the assumption that no congestion occurs in the tie line between Microgrids 1 and 2. Suppose that the congestion occurs, the increase amount of real power cannot be balanced by the IBRs in Microgrid 2. In such a case, µAGC2 cannot regulate frequencies in Microgrid 1 to the nominal value. VI. CONCLUSION In this paper, a cyber-resilient µAGC is proposed. A new microgrid modeling approach is introduced. The modeling approach exploits the rank-deﬁcient property of IBR dynamics. Such modeling approach leads to a fast µAGC design that requires no frequency measurements that may not be available in practice under fast load/renewable power ﬂuctuations. An end-to-end cyber security solution to FDI attack detection and mitigation is developed for the proposed µAGC. The proposed cyber-resilient µAGC is tested in a system of two microgrids. Simulation shows the proposed µAGC can regulate microgrid frequencies under fast renewable/load power ﬂuctuations, and its cyber security solution can detect and mitigate FDI attacks. Future work will investigate the impact of microgrid nonlin- earity on the cyber-resilient µAGC design and test and validate the proposed µAGC in a large-scale system of AC microgrids. REFERENCES [1] “Root cause analysis mid-August 2020 extreme heat wave,” California Independent System Operator, California Public Utilities Commission, California Energy Commission, Tech. Rep., 2021. [2] “The February 2021 cold weather outages in texas and the south central united states,” FERC, NERC, Tech. Rep., 2021. [3] T. Huang, S. Gao, and L. Xie, “A neural lyapunov approach to transient stability assessment of power electronics-interfaced networked micro- grids,” IEEE Transactions on Smart Grid, vol. 13, no. 1, pp. 106–118, 2022. [4] L. Xie, T. Huang, P. R. Kumar, A. A. Thatte, and S. K. Mitter, “On an information and control architecture for future electric energy systems,” Proceedings of the IEEE, pp. 1–23, 2022. [5] M. Farrokhabadi et al., “Microgrid stability deﬁnitions, analysis, and examples,” IEEE Transactions on Power Systems, 2020. [6] J. M. Guerrero et al., “Hierarchical control of droop-controlled ac and dc microgrids—a general approach toward standardization,” IEEE Transactions on industrial electronics, vol. 58, no. 1, pp. 158–172, 2010. [7] Simpson-Porco et al., “Secondary frequency and voltage control of islanded microgrids via distributed averaging,” IEEE Transactions on Industrial Electronics, vol. 62, no. 11, pp. 7025–7038, 2015. [8] J. Choi, S. I. Habibi, and A. Bidram, “Distributed ﬁnite-time event- triggered frequency and voltage control of ac microgrids,” IEEE Trans- actions on Power Systems, vol. 37, no. 3, pp. 1979–1994, 2021. [9] Y. Khayat et al., “On the secondary control architectures of ac micro- grids: An overview,” IEEE Transactions on Power Electronics, 2019. [10] J. P. Lopes, C. L. Moreira, and A. Madureira, “Deﬁning control strategies for microgrids islanded operation,” IEEE Transactions on power systems, vol. 21, no. 2, pp. 916–924, 2006. [11] A. G. Tsikalakis and N. D. Hatziargyriou, “Centralized control for optimizing microgrids operation,” in IEEE PES General Meeting, 2011. [12] S. Manaffam et al., “Intelligent pinning based cooperative secondary control of distributed generators for microgrid in islanding operation mode,” IEEE Transactions on Power Systems, 2017. [13] J. Shi, D. Yue, and S. Weng, “Distributed event-triggered mechanism for secondary voltage control with microgrids,” Transactions of the Institute of Measurement and Control, 2019. [14] Y. Han et al., “Analysis of washout ﬁlter-based power sharing strat- egy—an equivalent secondary controller for islanded microgrid without lbc lines,” IEEE Transactions on Smart Grid, 2017. [15] Y. Khayat et al., “Decentralized optimal frequency control in au- tonomous microgrids,” IEEE Transactions on Power Systems, 2018. [16] G. Lou et al., “Decentralised secondary voltage and frequency control scheme for islanded microgrid based on adaptive state estimator,” IET Generation, Transmission & Distribution, 2017. [17] Q.-C. Zhong and G. Weiss, “Synchronverters: Inverters that mimic synchronous generators,” IEEE Transactions on Industrial Electronics, vol. 58, no. 4, pp. 1259–1267, 2011. [18] N. Pogaku, M. Prodanovic, and T. C. Green, “Modeling, analysis and testing of autonomous operation of an inverter-based microgrid,” IEEE Transactions on Power Electronics, vol. 22, no. 2, pp. 613–625, 2007. 12 0.5 1 1.5 49.96 49.97 49.98 49.99 50 50.01 50.02 50.03 with control no control (a) 0.5 1 1.5 49.96 49.97 49.98 49.99 50 50.01 50.02 50.03 with control no control (b) 0.5 1 1.5 49.96 49.97 49.98 49.99 50 50.01 50.02 50.03 with control no control (c) Fig. 15. Performance of collaborative control in terms of regulating frequencies at IBR 1 (a), IBR 2 (b), and IBR 3 (c): the solid blue curves are frequency trajectories with the collaborative control, and the dashed orange curves are frequency trajectories without the collaborative control. Fig. 16. Frequencies at Microgrid 2 2 4 6 8 10 49.95 50 50.05 Node 1 Node 2 Node 3 Fig. 17. Frequencies at Microgrid 1 under slow load ﬂuctuations [19] S. Tan, P. Xie et al., “Cyberattack detection for converter-based dis- tributed dc microgrids: Observer-based approaches,” IEEE Industrial Electronics Magazine, 2021. [20] G. Hug and J. A. Giampapa, “Vulnerability assessment of ac state estimation with respect to false data injection cyber-attacks,” IEEE Transactions on smart grid, 2012. [21] M. N. Kurt et al., “Distributed quickest detection of cyber-attacks in smart grid,” IEEE Trans. on Information Forensics and Security, 2018. [22] L. Liu et al., “Detecting false data injection attacks on power grid by sparse optimization,” IEEE Transactions on Smart Grid, 2014. [23] A. O. Aluko et al., “Real-time cyber attack detection scheme for stand- alone microgrids,” IEEE Internet of Things Journal, 2022. [24] A. Cecilia et al., “On addressing the security and stability issues due to false data injection attacks in dc microgrids—an adaptive observer approach,” IEEE Transactions on Power Electronics, 2021. [25] H. H. Alhelou et al., “Deterministic dynamic state estimation-based 1 1.5 2 0 1000 2000 3000 Node 1 Node 2 Node 3 (a) 1 1.5 2 0 1000 2000 3000 Node 4 Node 5 (b) Fig. 18. (a) ∆PGi for i = 1, 2, 3; (b) ∆PGi for i = 4, 5 optimal LFC for interconnected power systems using unknown input observer,” IEEE Transactions on Smart Grid, 2019. [26] M. R. Khalghani et al., “Resilient frequency control design for mi- crogrids under false data injection,” IEEE Transactions on Industrial Electronics, 2020. [27] B. Satchidanandan and P. R. Kumar, “Dynamic watermarking: Active defense of networked cyber–physical systems,” Proceedings of the IEEE, vol. 105, no. 2, pp. 219–240, 2017. [28] Y. Guan and M. Saif, “A novel approach to the design of unknown input observers,” IEEE Transactions on Automatic Control, 1991. [29] J. M. Rey et al., “Secondary switched control with no communications for islanded microgrids,” IEEE Trans. on Industrial Electronics, 2017. [30] PMU (PLL-based, Positive-Sequence) Benchmark, MathWorks. [31] T. Huang, B. Satchidanandan, P. R. Kumar, and L. Xie, “An online detection framework for cyber attacks on automatic generation control,” IEEE Transactions on Power Systems, 2018. [32] EPRI, EPRI Power System Dynamic Tutorial, Electric Power Research Institution, July 2009. [33] C.-C. Sun, A. Hahn, and C.-C. Liu, “Cyber security of a power grid: State-of-the-art,” International Journal of Electrical Power & Energy Systems, vol. 99, pp. 45–56, 2018. [34] A. Barua and M. A. Al Faruque, “Hall spooﬁng: a noninvasive dos attack on grid-tied solar inverter,” in Proceedings of the 29th USENIX Conference on Security Symposium, 2020, pp. 1273–1290. [35] G. Liang, J. Zhao, F. Luo, S. R. Weller, and Z. Y. Dong, “A review of false data injection attacks against modern power systems,” IEEE Transactions on Smart Grid, 2016. [36] C.-C. Sun, D. J. Sebastian Cardenas, A. Hahn, and C.-C. Liu, “Intrusion detection for cybersecurity of smart meters,” IEEE Transactions on Smart Grid, vol. 12, no. 1, pp. 612–622, 2021. [37] Y. Li and J. Yan, “Cybersecurity of smart inverters in the smart grid: A survey,” IEEE Transactions on Power Electronics, vol. 38, no. 2, pp. 2364–2383, 2023. [38] M. Ilic and X. Liu, “A simple structural approach to modeling and analysis of the interarea dynamics of the large electric power systems: Part i—linearized models of frequency dynamics,” in North American Power Symposium, 1993, pp. 560–569. [39] Q. Liu, “Large-scale systems framework for coordinated frequency control of electric power systems,” Ph.D. dissertation, Carnegie Mellon University, 2013. 13 [40] Y. Liu, L. Zhan, Y. Zhang, P. N. Markham, D. Zhou, J. Guo, Y. Lei, G. Kou, W. Yao, J. Chai, and Y. Liu, “Wide-area-measurement system development at the distribution level: An FNET/GridEye example,” IEEE Transactions on Power Delivery, vol. 31, no. 2, pp. 721–731, 2016. [41] Y. Xia, Y. He, K. Wang, W. Pei, Z. Blazic, and D. P. Mandic, “A complex least squares enhanced smart dft technique for power system frequency estimation,” IEEE Transactions on Power Delivery, vol. 32, no. 3, pp. 1270–1278, 2017. [42] M. Karimi-Ghartemani, B.-T. Ooi, and A. Bakhshai, “Application of enhanced phase-locked loop system to the computation of synchropha- sors,” IEEE Transactions on Power Delivery, vol. 26, no. 1, pp. 22–32, 2011. [43] M. Begovic, P. Djuric, S. Dunlap, and A. Phadke, “Frequency tracking in power networks in the presence of harmonics,” IEEE Transactions on Power Delivery, vol. 8, no. 2, pp. 480–486, 1993. [44] IDM: Multifunction power system mopnitor, Qualtrol. [45] X. Miao, M. Ili´c, and Q. Liu, “Enhanced automatic generation control (E-AGC) for electric power systems with large intermittent renewable energy sources,” in 2019 IEEE PES General Meeting. [46] P. Van Overschee and B. De Moor, “N4sid: numerical algorithms for state space subspace system identiﬁcation,” in IFAC, 1993. [47] D. Wu, P. Bharadwaj, P. Rowles, and M. Ilic, “Cyber-physical secure observer-based corrective control under compromised sensor measure- ments,” in American Control Conference, 2022.